name: Deploy Spring Boot to Raspberry Pi

on:
  push:
    branches:
      - main  # main ë¸Œëœì¹˜ì— pushë  ë•Œ ì‹¤í–‰

jobs:
  deploy:
    runs-on: self-hosted  # Raspberry Piì—ì„œ ì‹¤í–‰

    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4  # GitHub ë ˆí¬ì§€í† ë¦¬ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°

      - name: ğŸ”§ Set up JDK 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: âš™ï¸ Build Spring Boot JAR
        run: |
          cd /home/persimmon/actions-runner/_work/molly-image-api/molly-image-api/
          ./gradlew build -x test  # Gradle ë¹Œë“œ (í…ŒìŠ¤íŠ¸ ì œì™¸)
        env:
          JAVA_HOME: /usr/lib/jvm/java-17-openjdk-arm64  # Raspberry Pi JDK ê²½ë¡œ

      - name: ğŸ“‚ Deploy to Raspberry Pi
        run: |
          cp /home/persimmon/actions-runner/_work/molly-image-api/molly-image-api/build/libs/molly-image-api.jar /home/persimmon/app/
          sudo chmod +x /home/persimmon/app/molly-image-restart.sh
          bash /home/persimmon/app/molly-image-restart.sh
