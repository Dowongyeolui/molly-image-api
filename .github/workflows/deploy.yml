name: Deploy Spring Boot to Raspberry Pi

on:
  push:
    branches:
      - main  # main ë¸Œëžœì¹˜ì— pushë  ë•Œ ì‹¤í–‰

jobs:
  deploy:
    runs-on: self-hosted  # Raspberry Piì—ì„œ ì‹¤í–‰

    steps:
      - name: ðŸ“¥ Checkout Repository
        uses: actions/checkout@v4  # GitHub ë ˆí¬ì§€í† ë¦¬ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°

      - name: ðŸ”§ Set up JDK 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: âš™ï¸ Build Spring Boot JAR
        run: |
          ./gradlew build -x test  # Gradle ë¹Œë“œ (í…ŒìŠ¤íŠ¸ ì œì™¸)
        env:
          JAVA_HOME: /usr/lib/jvm/java-17-openjdk-arm64  # Raspberry Pi JDK ê²½ë¡œ

      - name: ðŸ“‚ Deploy to Raspberry Pi
        run: |
          ssh-keyscan -H 192.168.219.105 >> ~/.ssh/known_hosts
          scp build/libs/*.jar persimmon@192.168.219.105:/home/persimmon/app/
          ssh persimmon@192.168.219.105 "bash /home/persimmon/app/molly-image-restart.sh"
